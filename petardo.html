<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Petardo Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{
  margin:0;
  background:#111;
  overflow:hidden;
  user-select:none;
  font-family:Arial,sans-serif;
  touch-action:none;
}

/* ---------------- INTRO ---------------- */
#intro{
  position:fixed;
  inset:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:9999;
  overflow:hidden;
}

#intro canvas{
  position:absolute;
  inset:0;
}

#intro h1{
  font-size:clamp(48px,8vw,80px);
  text-transform:uppercase;
  background:linear-gradient(90deg,#ff0,#f0f,#0ff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:glow 1.5s infinite alternate;
  z-index:1;
}

@keyframes glow{
  to{text-shadow:0 0 40px #f0f;}
}

#loading-bar{
  width:300px;
  height:16px;
  background:#333;
  border-radius:10px;
  overflow:hidden;
  margin-top:20px;
  z-index:1;
}

#loading-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff0,#f0f,#0ff);
}

/* ---------------- GAME ---------------- */
#game{
  position:relative;
  width:100vw;
  height:100vh;
  display:none;
}

#coins{
  position:absolute;
  top:10px;
  left:10px;
  font-size:28px;
  font-weight:bold;
  color:yellow;
  z-index:2000;
}

#petardo{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  display:none;
  pointer-events:none;
}

#mechero{
  position:absolute;
  width:70px;
  left:20px;
  top:120px;
  z-index:1500;
}

#flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  pointer-events:none;
}

/* ---------------- MOCHILA ---------------- */
#backpack{
  position:absolute;
  right:20px;
  bottom:120px;
  width:70px;
  z-index:1600;
}

#backpack-popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  z-index:3000;
}

#backpack-content{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  border:2px solid #fff;
  width:90%;
  max-width:420px;
  max-height:70vh;
  overflow-y:auto;
  padding:15px;
}

.petardo-item{
  display:flex;
  align-items:center;
  background:#333;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
}

.petardo-item img{
  width:50px;
  margin-right:10px;
}

.petardo-item span{
  color:white;
  font-weight:bold;
}

/* ---------------- BOTON FUEGO ---------------- */
#fire-btn{
  position:fixed;
  left:20px;
  bottom:20px;
  width:80px;
  height:80px;
  border-radius:50%;
  background:red;
  color:white;
  font-size:36px;
  display:none;
  justify-content:center;
  align-items:center;
  z-index:1700;
}

/* ---------------- TUTORIAL ---------------- */
#tutorial{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  z-index:4000;
}

#tutorial-box{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  border:2px solid #fff;
  padding:20px;
  max-width:400px;
  text-align:center;
}

#tutorial-box p{
  color:white;
}

#tutorial-btn{
  background:red;
  color:white;
  padding:10px 20px;
  border:none;
  opacity:.5;
}

/* ---------------- MOBILE ---------------- */
@media (max-width:768px){
  #coins{font-size:8vw;}
  #petardo{width:32vw;}
  #mechero{width:18vw;}
  #backpack{width:18vw; bottom:130px;}
  #fire-btn{display:flex;}
}
</style>
</head>
<body>

<div id="intro">
  <canvas id="intro-canvas"></canvas>
  <h1>Petardo Simulator</h1>
  <div id="loading-bar"><div id="loading-fill"></div></div>
</div>

<div id="game">
  <div id="coins">0‚Ç¨</div>
  <img id="petardo">
  <img id="mechero">
  <img id="backpack" src="https://files.catbox.moe/blmbxl.png">
  <div id="flash"></div>
  <div id="fire-btn">üî•</div>
</div>

<div id="backpack-popup">
  <div id="backpack-content"></div>
</div>

<div id="tutorial">
  <div id="tutorial-box">
    <p>
      ¬°Hola! Bienvenido a Petardo Simulator.<br><br>
      Abre la mochila, elige un petardo y enci√©ndelo con el mechero üî•
    </p>
    <button id="tutorial-btn">CERRAR (10)</button>
  </div>
</div>

<script>
/* INTRO */
const canvas=document.getElementById("intro-canvas");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;canvas.height=innerHeight;
let parts=[...Array(120)].map(()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,vx:(Math.random()-0.5)*2,vy:(Math.random()-0.5)*2,c:`hsl(${Math.random()*360},100%,70%)`}));
(function anim(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  parts.forEach(p=>{
    p.x+=p.vx;p.y+=p.vy;
    if(p.x<0)p.x=canvas.width;if(p.x>canvas.width)p.x=0;
    if(p.y<0)p.y=canvas.height;if(p.y>canvas.height)p.y=0;
    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,2,2);
  });
  requestAnimationFrame(anim);
})();

/* LOAD */
const fill=document.getElementById("loading-fill");
let prog=0;
const load=setInterval(()=>{
  prog+=2;
  fill.style.width=prog+"%";
  if(prog>=100){
    clearInterval(load);
    startGame();
  }
},40);

/* GAME */
function startGame(){
  document.getElementById("intro").remove();
  const game=document.getElementById("game");
  game.style.display="block";

  const petardoImg=document.getElementById("petardo");
  const mechero=document.getElementById("mechero");
  mechero.src="https://files.catbox.moe/xhzxrf.png";

  let holding=false,drag=false,ignition=0,exploded=false;
  let coins=+localStorage.getItem("coins")||0;
  let explodedCount=+localStorage.getItem("explodedCount")||0;
  document.getElementById("coins").textContent=coins+"‚Ç¨";

  const petardos=[
    {name:"Silba Boom",src:"https://files.catbox.moe/1udjsa.png",size:90,power:3,money:3,needed:0},
    {name:"Scream 100",src:"https://files.catbox.moe/ni5xz1.png",size:140,power:5,money:5,needed:5},
    {name:"Gigant Maroon",src:"https://files.catbox.moe/rn89n9.png",size:160,power:10,money:25,needed:10},
    {name:"Cobra 8",src:"https://files.catbox.moe/ddenev.png",size:180,power:35,money:40,needed:15}
  ];

  let current=null;

  /* DRAG MECHERO */
  mechero.onmousedown=()=>drag=true;
  document.onmouseup=()=>drag=false;
  document.onmousemove=e=>{
    if(drag){
      mechero.style.left=Math.min(innerWidth-80,Math.max(0,e.clientX-40))+"px";
      mechero.style.top=Math.min(innerHeight-80,Math.max(0,e.clientY-40))+"px";
    }
  };

  mechero.ontouchstart=e=>{drag=true;e.preventDefault();}
  mechero.ontouchend=()=>drag=false;
  mechero.ontouchmove=e=>{
    if(drag){
      const t=e.touches[0];
      mechero.style.left=Math.min(innerWidth-80,Math.max(0,t.clientX-40))+"px";
      mechero.style.top=Math.min(innerHeight-80,Math.max(0,t.clientY-40))+"px";
    }
  };

  /* FIRE BTN */
  const fire=document.getElementById("fire-btn");
  fire.onmousedown=()=>holding=true;
  fire.onmouseup=()=>holding=false;
  fire.ontouchstart=e=>{holding=true;e.preventDefault();}
  fire.ontouchend=()=>holding=false;

  /* MOCHILA */
  const backpack=document.getElementById("backpack");
  const popup=document.getElementById("backpack-popup");
  const content=document.getElementById("backpack-content");

  backpack.onclick=()=>{
    popup.style.display="block";
    content.innerHTML="<h3 style='color:white'>Mochila</h3>";
    petardos.forEach(p=>{
      const div=document.createElement("div");
      div.className="petardo-item";
      if(p.needed>explodedCount){
        div.style.filter="blur(2px)";
        div.innerHTML=`<img src="${p.src}"><span style="color:red">TIRA ${p.needed-explodedCount} M√ÅS</span>`;
      }else{
        div.innerHTML=`<img src="${p.src}"><span>${p.name}</span>`;
        div.onclick=()=>{
          current=p;
          petardoImg.src=p.src;
          petardoImg.style.width=p.size+"px";
          petardoImg.style.display="block";
          exploded=false;
          ignition=0;
          popup.style.display="none";
        };
      }
      content.appendChild(div);
    });
  };

  popup.onclick=e=>{if(e.target===popup)popup.style.display="none";};

  /* LOOP */
  function near(){
    if(!current)return false;
    const a=mechero.getBoundingClientRect();
    const b=petardoImg.getBoundingClientRect();
    return Math.hypot(a.left-b.left,a.top-b.top)<80;
  }

  function loop(){
    if(current && !exploded && holding && near()){
      ignition+=16;
      if(ignition>2500)explode();
    }else ignition=0;
    requestAnimationFrame(loop);
  }
  loop();

  function explode(){
    exploded=true;
    coins+=current.money;
    explodedCount++;
    localStorage.setItem("coins",coins);
    localStorage.setItem("explodedCount",explodedCount);
    document.getElementById("coins").textContent=coins+"‚Ç¨";
    petardoImg.style.display="none";
    document.getElementById("flash").style.opacity=1;
    setTimeout(()=>document.getElementById("flash").style.opacity=0,80);
  }

  /* TUTORIAL */
  if(!localStorage.getItem("tutorialDone")){
    const tut=document.getElementById("tutorial");
    const btn=document.getElementById("tutorial-btn");
    tut.style.display="block";
    let c=10;
    const iv=setInterval(()=>{
      c--;btn.textContent="CERRAR ("+c+")";
      if(c<=0){
        clearInterval(iv);
        btn.style.opacity=1;
        btn.onclick=()=>{
          tut.style.display="none";
          localStorage.setItem("tutorialDone",1);
        };
      }
    },1000);
  }
}
</script>

</body>
</html>
