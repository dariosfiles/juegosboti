<!DOCTYPE html>
<html lang="es">
<head>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<meta charset="UTF-8">
<title>Petardo Simulator</title>
<style>
body{
  margin:0;
  background:#111;
  overflow:hidden;
  user-select:none;
  font-family:Arial,sans-serif;
}

/* --- Intro moderna --- */
#intro{
  position:fixed;
  inset:0;
  background:#111;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
  overflow:hidden;
}

#intro-canvas{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:0;
}

#intro-title{
  font-size:72px;
  font-weight:bold;
  text-transform: uppercase;
  background: linear-gradient(90deg, #ff3, #f06, #0ff, #f0f);
  background-size: 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradientAnim 5s linear infinite, glow 1.5s ease-in-out infinite alternate;
  z-index:1;
  margin:0;
  text-align:center;
  text-shadow: 0 0 10px #fff, 0 0 20px #f06, 0 0 30px #0ff;
}

@keyframes gradientAnim{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

@keyframes glow{
  0%{text-shadow:0 0 10px #fff,0 0 20px #f06,0 0 30px #0ff;}
  100%{text-shadow:0 0 20px #fff,0 0 40px #f06,0 0 60px #0ff;}
}

#loading-container{
  position:relative;
  z-index:1;
  width:300px;
  text-align:center;
  margin-top:30px;
}

#loading-bar{
  width:100%;
  height:20px;
  background:#333;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:10px;
}

#loading-fill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg,#ff0,#f0f,#0ff);
  border-radius:10px;
  transition: width 0.2s ease;
}

#loading-text{
  color:#fff;
  font-weight:bold;
  text-shadow:0 0 5px #ff0, 0 0 10px #f0f;
}

/* --- Juego --- */
#game{
  position:relative;
  width:100vw;
  height:100vh;
  display:none;
}

#coins{
  position:absolute;
  top:15px;
  left:15px;
  font-size:32px;
  font-weight:bold;
  color:yellow;
  z-index:1000;
  text-shadow:1px 1px 2px black;
}

#petardo{
  position:absolute;
  width:90px;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  pointer-events:none;
  display:none;
}

#mechero{
  position:absolute;
  width:64px;
  left:120px;
  top:120px;
  cursor:grab;
}

.fuse-particle{
  position:absolute;
  width:4px;
  height:4px;
  background:red;
  border-radius:50%;
  pointer-events:none;
}

.particle{
  position:absolute;
  width:8px;
  height:8px;
  border-radius:50%;
  pointer-events:none;
}

.shockwave{
  position:absolute;
  width:20px;
  height:20px;
  border:3px solid rgba(255,255,255,.8);
  border-radius:50%;
  transform:translate(-50%,-50%);
  animation:wave .5s ease-out forwards;
}

@keyframes wave{
  to{width:240px;height:240px;opacity:0;}
}

#flash{
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  pointer-events:none;
}

/* MOCHILA */
#backpack{
  position:absolute;
  bottom:20px;
  right:20px;
  width:64px;
  height:64px;
  cursor:pointer;
  z-index:1000;
}

#backpack-popup{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  border:2px solid #fff;
  padding:20px;
  display:none;
  z-index:2000;
  max-width:400px;
  max-height:70vh;
  overflow-y:auto;
}

#backpack-popup h2{
  margin-top:0;
  color:white;
}

#close-backpack{
  position:absolute;
  top:5px;
  right:10px;
  cursor:pointer;
  color:white;
  font-weight:bold;
}

.petardo-item{
  display:flex;
  align-items:center;
  margin-bottom:10px;
  cursor:pointer;
  background:#333;
  padding:5px;
  border-radius:5px;
}

.petardo-item img{
  width:35px;
  height:35px;
  margin-right:10px;
}

.petardo-item span{
  color:white;
}

/* POPUP TUTORIAL */
#tutorial-popup{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#222;
  border:2px solid #fff;
  padding:20px;
  z-index:3000;
  max-width:400px;
  display:none;
}

#tutorial-popup p{
  color:white;
  margin:0 0 15px 0;
}

#tutorial-btn{
  background:red;
  color:white;
  border:none;
  padding:10px 20px;
  cursor:not-allowed;
  opacity:0.5;
}

/* BOTON DE FUEGO */
#fire-btn{
  position:fixed;
  bottom:20px;
  left:20px;
  width:64px;
  height:64px;
  background:red;
  border-radius:50%;
  display:none; /* solo m√≥vil */
  justify-content:center;
  align-items:center;
  color:white;
  font-size:32px;
  z-index:1500;
  user-select:none;
  touch-action: none;
}

/* --- RESPONSIVE M√ìVIL --- */
@media (max-width:768px){
  #coins{ font-size:8vw; } 
  #mechero{ width:16vw; } 
  #backpack{ 
    width:14vw; 
    height:14vw; 
    bottom:80px; /* subimos la mochila */
  }
  #petardo{ width:25vw; } 
  #fire-btn{ 
    display:flex; 
    width:90px; 
    height:90px; 
    font-size:48px; 
    bottom:20px; 
    left:20px;
  }
}
</style>
</head>
<body>

<div id="intro">
  <canvas id="intro-canvas"></canvas>
  <h1 id="intro-title">Petardo Simulator</h1>
  <div id="loading-container">
    <div id="loading-bar"><div id="loading-fill"></div></div>
    <p id="loading-text">Cargando juego...</p>
  </div>
</div>

<div id="game">
  <div id="coins">0‚Ç¨</div>
  <img id="petardo">
  <img id="mechero" draggable="false">
  <div id="flash"></div>

  <!-- Mochila -->
  <img id="backpack" src="https://files.catbox.moe/blmbxl.png">
  <div id="backpack-popup">
    <div id="close-backpack">X</div>
    <h2>Mochila</h2>
    <div id="petardo-list"></div>
  </div>

  <!-- Bot√≥n de fuego -->
  <div id="fire-btn">üî•</div>
</div>

<div id="tutorial-popup">
  <p>¬°Hola! Bienvenido a Petardo Simulator, para jugar, haz clic en la mochila de la esquina y elige tu petardo favorito, podr√°s explotarlo con tu mechero. ¬°Disfruta el juego y que lo pases bien!</p>
  <button id="tutorial-btn">CERRAR (10)</button>
</div>

<script>
// Detectar si es m√≥vil
function isMobile() {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

if(isMobile()) {
  Swal.fire({
    icon: 'error',
    title: 'Dispositivo incorrecto',
    text: 'Solo se puede jugar en PC.',
    confirmButtonText: 'Cerrar'
  }).then(() => {
    // Redirigir al cerrar la alerta
    window.location.href = 'https://juegosboti.xyz';
  });
} else {
  // Inicia el juego normalmente
  startGame();
}
// --- Intro particles ---
const canvas = document.getElementById("intro-canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let particles = [];
for(let i=0;i<100;i++){
  particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,vx:(Math.random()-0.5)*2,vy:(Math.random()-0.5)*2,size:Math.random()*3+1,color:`hsl(${Math.random()*360},100%,70%)`});
}
function animateParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy;
    if(p.x<0)p.x=canvas.width;if(p.x>canvas.width)p.x=0;
    if(p.y<0)p.y=canvas.height;if(p.y>canvas.height)p.y=0;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();

// --- Carga assets ---
const assets={mechero:{type:"image",src:"https://files.catbox.moe/xhzxrf.png"},explosion:{type:"audio",src:"https://files.catbox.moe/9jun2y.mp3"}};
const MIN_LOAD=5000;let loaded=0;const total=Object.keys(assets).length;const start=performance.now();
const fill=document.getElementById("loading-fill");
for(const k in assets){const a=assets[k];if(a.type==="image"){const i=new Image();i.onload=i.onerror=()=>loaded++;i.src=a.src;assets[k]=i;}else{const au=new Audio();au.oncanplaythrough=au.onerror=()=>loaded++;au.src=a.src;au.load();assets[k]=au;}}
(function loadLoop(){const tProg=Math.min((performance.now()-start)/MIN_LOAD,1);const rProg=loaded/total;fill.style.width=(Math.min(tProg,rProg)*100)+"%";if(loaded===total && performance.now()-start>=MIN_LOAD) startGame(); else requestAnimationFrame(loadLoop);})();

function startGame(){
  document.getElementById("intro").remove();
  const game=document.getElementById("game");
  game.style.display="block";

  const petardo=document.getElementById("petardo");
  const mechero=document.getElementById("mechero");
  const flash=document.getElementById("flash");
  const boomSound=assets.explosion;
  mechero.src=assets.mechero.src;

  let dragging=false,holdingE=false,exploded=false;
  let ignition=0,last=null,fuseInterval=null;

  let coins=parseInt(localStorage.getItem("coins")||"0");
  document.getElementById("coins").textContent=coins+"‚Ç¨";
  window.explodedCount=parseInt(localStorage.getItem("explodedCount")||"0");

  const petardos=[{name:"Silba Boom",src:"https://files.catbox.moe/1udjsa.png",size:90,power:3,money:3,needed:0},{name:"Scream 100",src:"https://files.catbox.moe/ni5xz1.png",size:140,power:5,money:5,needed:5}];
  let currentPetardo=null;

  /* Drag mechero */
  mechero.onmousedown=()=>dragging=true;
  document.onmouseup=()=>dragging=false;
  document.onmousemove=e=>{if(dragging){const x=Math.min(Math.max(0,e.clientX-32),window.innerWidth-64);const y=Math.min(Math.max(0,e.clientY-32),window.innerHeight-64);mechero.style.left=x+"px";mechero.style.top=y+"px";}};
  mechero.addEventListener("touchstart", e=>{e.preventDefault(); dragging=true;},{passive:false});
  mechero.addEventListener("touchend", e=>{e.preventDefault(); dragging=false;},{passive:false});
  mechero.addEventListener("touchmove", e=>{if(dragging && e.touches.length>0){const touch=e.touches[0];const x=Math.min(Math.max(0,touch.clientX-32),window.innerWidth-64);const y=Math.min(Math.max(0,touch.clientY-32),window.innerHeight-64);mechero.style.left=x+"px";mechero.style.top=y+"px";}}, {passive:false});

  /* Bot√≥n fuego */
  const fireBtn=document.getElementById("fire-btn");
  fireBtn.addEventListener("mousedown",()=>holdingE=true);
  fireBtn.addEventListener("mouseup",()=>holdingE=false);
  fireBtn.addEventListener("mouseleave",()=>holdingE=false);
  fireBtn.addEventListener("touchstart", e=>{e.preventDefault(); holdingE=true;},{passive:false});
  fireBtn.addEventListener("touchend", e=>{e.preventDefault(); holdingE=false;},{passive:false});

  document.onkeydown=e=>{if(e.key==="e"||e.key==="E")holdingE=true;}
  document.onkeyup=e=>{if(e.key==="e"||e.key==="E")holdingE=false;}

  /* Mochila */
  const backpack=document.getElementById("backpack");
  const backpackPopup=document.getElementById("backpack-popup");
  const closeBackpack=document.getElementById("close-backpack");
  const petardoList=document.getElementById("petardo-list");
  backpack.onclick=()=>backpackPopup.style.display="block";
  closeBackpack.onclick=()=>backpackPopup.style.display="none";

  function renderPetardos(){
    petardoList.innerHTML="";
    petardos.forEach(p=>{
      const div=document.createElement("div");
      div.className="petardo-item";
      if((p.needed||0) > (window.explodedCount||0)){
        div.style.filter="blur(2px)";
        const faltan=p.needed-(window.explodedCount||0);
        div.innerHTML=`<img src="${p.src}"><span style="color:red;font-weight:bold;">TIRA ${faltan} PETARDOS M√ÅS PARA DESBLOQUEAR</span>`;
      } else {
        div.innerHTML=`<img src="${p.src}"><span>${p.name}</span>`;
        div.onclick=()=>{
          currentPetardo=p;
          petardo.src=p.src;
          petardo.style.width=(p.size||90)+"px";
          petardo.style.display="block";
          exploded=false;
          ignition=0;
          backpackPopup.style.display="none";
        };
      }
      petardoList.appendChild(div);
    });
  }
  renderPetardos();

  /* Tutorial */
  const tutorialPopup=document.getElementById("tutorial-popup");
  const tutorialBtn=document.getElementById("tutorial-btn");
  if(!localStorage.getItem("tutorialDone")){
    tutorialPopup.style.display="block";
    let count=10;
    tutorialBtn.textContent=`CERRAR (${count})`;
    const interval=setInterval(()=>{
      count--; tutorialBtn.textContent=`CERRAR (${count})`;
      if(count<=0){tutorialBtn.disabled=false;tutorialBtn.style.cursor="pointer";tutorialBtn.style.opacity=1;clearInterval(interval);}
    },1000);
    tutorialBtn.onclick=()=>{
      tutorialPopup.style.display="none";
      localStorage.setItem("tutorialDone","1");
    };
  }

  /* Loop principal */
  function near(a,b,d=75){const ra=a.getBoundingClientRect(),rb=b.getBoundingClientRect();return Math.hypot(ra.left+ra.width/2-(rb.left+rb.width/2),ra.top+ra.height/2-(rb.top+rb.height/2))<d;}
  function startFuse(){if(fuseInterval)return;fuseInterval=setInterval(()=>{const r=petardo.getBoundingClientRect();const x=r.left+r.width*0.7;const y=r.top+r.height*0.1;const p=document.createElement("div");p.className="fuse-particle";p.style.left=x+"px";p.style.top=y+"px";game.appendChild(p);let life=0,vx=(Math.random()-.5)*1.5,vy=-Math.random()*2;const iv=setInterval(()=>{life++;p.style.left=p.offsetLeft+vx+"px";p.style.top=p.offsetTop+vy+"px";p.style.opacity-=0.08;if(life>10){clearInterval(iv);p.remove();}},16);},80);}
  function stopFuse(){clearInterval(fuseInterval);fuseInterval=null;}
  function cameraShake(intensity=12,duration=300){const startTime=performance.now();(function shake(t){const elapsed=t-startTime;const p=1-(elapsed/duration);if(p<=0){game.style.transform="";return;}const x=(Math.random()*2-1)*intensity*p;const y=(Math.random()*2-1)*intensity*p;game.style.transform=`translate(${x}px,${y}px)`;requestAnimationFrame(shake);})(startTime);}
  function addCoins(amount){coins+=amount;localStorage.setItem("coins",coins);document.getElementById("coins").textContent=coins+"‚Ç¨";}

  function loop(t){
    if(!last) last=t;
    const dt=t-last; last=t;
    if(currentPetardo && !exploded && holdingE && near(mechero,petardo)){
      ignition+=dt; startFuse(); if(ignition>=3000) explode();
    } else { ignition=0; stopFuse();}
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  function explode(){
    if(!currentPetardo)return;
    exploded=true; stopFuse(); boomSound.currentTime=0; boomSound.play(); cameraShake(14*currentPetardo.power,350); addCoins(currentPetardo.money||3);
    const r=petardo.getBoundingClientRect();const x=r.left+r.width/2,y=r.top+r.height/2;petardo.style.display="none";
    flash.style.opacity=1; setTimeout(()=>flash.style.opacity=0,80);
    const wave=document.createElement("div");wave.className="shockwave";const waveSize=20+currentPetardo.power*50;wave.style.width=wave.style.height=waveSize+"px";wave.style.left=x+"px";wave.style.top=y+"px";game.appendChild(wave);setTimeout(()=>wave.remove(),500);
    for(let i=0;i<35;i++){const p=document.createElement("div");p.className="particle";p.style.background=Math.random()>.5?"red":"orange";p.style.left=x+"px";p.style.top=y+"px";game.appendChild(p);const a=Math.random()*Math.PI*2,s=Math.random()*7+3;let life=0;const iv=setInterval(()=>{life++;p.style.left=p.offsetLeft+Math.cos(a)*s+"px";p.style.top=p.offsetTop+Math.sin(a)*s+"px";p.style.opacity-=0.04;if(life>25){clearInterval(iv);p.remove();}},16);}
    window.explodedCount++; localStorage.setItem("explodedCount",window.explodedCount); renderPetardos();
  }
}
</script>

</body>
</html>
